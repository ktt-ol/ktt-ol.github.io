<!doctype html><html prefix="og: https://ogp.me/ns#" data-bs-theme=dark lang=de><head><meta charset=utf-8><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="Kreativität trifft Technik e.V." property=og:site_name><meta content=de_DE property=og:locale><meta content=de_DE property=og:locale:alternate><meta content=en_US property=og:locale:alternate><meta content=https://ktt-ol.github.io/blog/2016/display-grabber property=og:url><meta content=sre name=author><meta content=article property=og:type><script type=application/ld+json>
        {
            "@context": "https://schema.org/",
            "@type": "ImageObject",
            "contentUrl": "https://ktt-ol.github.io/media/blog/2016/abus-cfa1000-display-grabber/thumbnail.png",
        "license": "https://creativecommons.org/licenses/by-sa/4.0/",
        "acquireLicensePage": "https://creativecommons.org/licenses/by-sa/4.0/",
        "creditText": "CFA1000 Display Grabber",
        "creator": {
            "@type": "Person",
            "name": "sre",
            "url": "https://mainframe.io"
        },
        "copyrightNotice": "sre"
    }
    </script><meta content=https://ktt-ol.github.io/media/blog/2016/abus-cfa1000-display-grabber/thumbnail.png property=og:image><meta content=https://ktt-ol.github.io/media/blog/2016/abus-cfa1000-display-grabber/thumbnail.png property=og:image:secure_url><meta content=image/png property=og:image:type><meta content=205 property=og:image:width><meta content=180 property=og:image:height><meta content="CFA1000 Display Grabber" property=og:image:alt><meta content=summary_large_image property=twitter:card><meta content=sre property=twitter:site><meta content=sre property=twitter:creator><meta content=https://ktt-ol.github.io/media/blog/2016/abus-cfa1000-display-grabber/thumbnail.png property=twitter:image><meta content="CFA1000 Display Grabber" property=twitter:title><meta content=205 property=twitter:image:width><meta content=image/png property=twitter:image:type><meta content=180 property=twitter:image:height><meta content=sre name=article:author><meta content=2016 name=article:section><meta content=2024-03-24T23:42:00 name=article:modified_time><meta content=2016-12-10T00:00:00 name=article:published_time><script type=application/ld+json>
        {
            "@context": "https://schema.org",
            "@type": "NewsArticle",
            "headline": "CFA1000 Display Grabber",
        "image": [
            "https://ktt-ol.github.io/media/blog/2016/abus-cfa1000-display-grabber/thumbnail.png"
        ],
        "datePublished": "2016-12-10T00:00:00",
        "dateModified": "2024-03-24T23:42:00",
        "author": [
            {
                "@type": "Person",
                "name": "sre",
                "url": "https://ktt-ol.github.io"
            }
        ],
        "description": "Website des Kreativität trifft Technik e.V."
    }
    </script><title>CFA1000 Display Grabber | Kreativität trifft Technik e.V.</title><meta content="CFA1000 Display Grabber | Kreativität trifft Technik e.V." property=og:title><meta content="Website des Kreativität trifft Technik e.V." property=og:description><meta content="Website des Kreativität trifft Technik e.V." name=description><script type=application/ld+json>
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "image": "https://www.ktt-ol.de/media/img/logo-ktt.png",
            "url": "https://www.ktt-ol.de",
            "sameAs": [
                "https://mainframe.io",
                "https://kreativitaet-trifft-technik.de",
                "https://kreativität-trifft-technik.de"
            ],
            "logo": "https://www.ktt-ol.de/media/img/logo-ktt.png",
            "name": "Kreativität trifft Technik e.V.",
            "description": "Kreativität trifft Technik e.V. - Hackspace Oldenburg",
            "email": "vorstand@ktt-ol.de",
            "telephone": "+49441-559 700 32",
            "address": {
                "@type": "PostalAddress",
                "streetAddress": "Bahnhofsplatz 10",
                "addressLocality": "Oldenburg",
                "addressCountry": "DE",
                "addressRegion": "Innenstadt",
                "postalCode": "26122"
            },
            "vatID": "",
            "iso6523Code": ""
        }
    </script><link href=https://ktt-ol.github.io/css/site.css rel=stylesheet><link href=https://ktt-ol.github.io/rss.xml rel=alternate title=RSS type=application/rss+xml><link href=https://ktt-ol.github.io/atom.xml rel=alternate title=RSS type=application/rss+xml><body class="vh-100 m-0 p-0"><div class="container-lg h-100 px-lg-0 px-4 d-flex flex-column text-white"><header class="row my-2" id=navbar><div class=col><nav class="navbar navbar-expand-lg bg-body-secondary rounded"><div class=container-fluid><a class=navbar-brand href=https://ktt-ol.github.io/ style=padding-top:10px;padding-bottom:10px> <img alt="Mainframe Logo" id=img-logo-mainframe src=https://ktt-ol.github.io/media/img/logo-mainframe.svg style=height:28px> </a><button aria-label="Toggle navigation" aria-expanded=false class=navbar-toggler data-bs-target=#navbarNav data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav me-auto"><li class="nav-item dropdown"><a class="text-white text-decoration-none d-block py-2 pe-3 dropdown-toggle" aria-expanded=false data-bs-toggle=dropdown href=# role=button> Der Verein </a> <ul class=dropdown-menu><li><a class=dropdown-item href=/about/about/> Über uns </a><li><a class=dropdown-item href=/about/membership/> Mitgliedschaft </a><li><a class=dropdown-item href=/about/support/> Unterstützen </a><li><a class=dropdown-item href=/about/communication/> Kommunikation </a><li><a class=dropdown-item href=/about/in-the-press/> Pressespiegel </a><li><a class=dropdown-item href=/about/history/> Vereinsgeschichte </a></ul><li class="nav-item dropdown"><a class="text-white text-decoration-none d-block py-2 pe-3 dropdown-toggle" aria-expanded=false data-bs-toggle=dropdown href=# role=button> Räume </a> <ul class=dropdown-menu><li><a class=dropdown-item href=/spacewalk/overview/> Übersicht </a><li><a class=dropdown-item href=/spacewalk/lasercutter/> Lasercutter </a><li><a class=dropdown-item href=/spacewalk/elektronik-werkstatt/> Elektronik-Werkstatt </a><li><a class=dropdown-item href=/spacewalk/3d-lab/> 3D-Labor </a><li><a class=dropdown-item href=/spacewalk/schnittstelle/> Schnittstelle (Textilien) </a><li><a class=dropdown-item href=/spacewalk/radstelle/> Radstelle (Fahrrad) </a><li><a class=dropdown-item href=/spacewalk/holz-werkstatt/> Holz-Werkstatt </a><li><a class=dropdown-item href=/spacewalk/metall-werkstatt/> Metall-Werkstatt </a><li><a class=dropdown-item href=/spacewalk/foto-lab/> Foto-Labor </a><li><a class=dropdown-item href=/spacewalk/rem/> REM </a><li><a class=dropdown-item href=/spacewalk/kueche/> Küche </a><li><a class=dropdown-item href=/spacewalk/lounge/> Conference, Freifläche, Lounge </a></ul><li class="nav-item dropdown"><a class="text-white text-decoration-none d-block py-2 pe-3 dropdown-toggle" aria-expanded=false data-bs-toggle=dropdown href=# role=button> Bilder </a> <ul class=dropdown-menu><li><a class=dropdown-item href=/images/panorama/> Virtual Tour </a><li><a class=dropdown-item href=/images/albums/> Fotoalben </a><li><a class=dropdown-item href=/images/ifs/> Images From Space </a></ul><li class=nav-item><a class="text-white text-decoration-none d-block py-2 pe-3" aria-expanded=false href=https://ktt-ol.github.io/blog/ role=button> Blog </a><li class=nav-item><a class="text-white text-decoration-none d-block py-2 pe-3" aria-expanded=false href=https://ktt-ol.github.io/calendar/ role=button> Termine </a><li class=nav-item><a class="text-white text-decoration-none d-block py-2 pe-3" aria-expanded=false href=https://ktt-ol.github.io/contact/ role=button> Kontakt </a><li class=nav-item><a class="text-white text-decoration-none d-block py-2 pe-3" aria-expanded=false href=https://ktt-ol.github.io/contact/#anreise role=button> Anreise </a></ul><ul class="navbar-nav navbar-right"><li class="nav-item dropdown"><a class="text-white text-decoration-none d-block py-2 pe-3 dropdown-toggle" aria-expanded=false data-bs-toggle=dropdown href=# role=button>  <svg class="bi bi-translate" viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><path d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286zm1.634-.736L5.5 3.956h-.049l-.679 2.022z"></path><path d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm7.138 9.995q.289.451.63.846c-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6 6 0 0 1-.415-.492 2 2 0 0 1-.94.31"></path></svg> </a> <ul class=dropdown-menu><li><a class=dropdown-item href=/blog/2016/display-grabber> <img alt="german flag" class=me-1 src=https://ktt-ol.github.io/media/img/lang/de.png> Deutsch </a><li><a class=dropdown-item href=/en/blog/2016/display-grabber> <img alt="english flag" class=me-1 src=https://ktt-ol.github.io/media/img/lang/en.png> Englisch </a></ul></ul></div></div></nav></div></header><main class=row id=content><div class=col-lg-9><h1 class="d-flex justify-content-between">CFA1000 Display Grabber <span class=text-end> <a class="badge text-bg-light" rel="nofollow noreferrer noopener" href=https://github.com/ktt-ol/abus-cfa1000-display-grabber/ target=_blank> Repository </a> </span></h1><div class=main-content><p><img alt=Cover decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/cover.jpg><p>For our access control system, we needed a motor lock for our main door. After having a look how other hackspaces solved the problem, we decided to get ourself an ABUS CFA1000. It’s quite popular among Hackspaces, Fablabs and Makerspaces for two reasons:<ul><li>It’s cheap (< 100€) compared to other solutions, which often cost over 500€<li>It does not require door modifications (our main door probably contains asbestos)<li>The schematics are available from the Internet</ul><p>Once we received the piece of hardware, we opened it up and had a look at the hardware. Usually the ABUS CFA1000 is used together with a simple radio remote control. The manual advertises, that a “secure” rolling-key system is used to encrypt the information exchange. We don’t trust that part and do not need wireless support, so we disabled that part of the ABUS. The radio support is conveniently placed onto its own PCB inside of the CFA1000, so we could just cut the interconnections (Vcc, GND, Signal) between the main PCB and the radio interface PCB. We also removed the radio PCB to gain some space inside of the case.<p>That left us with a block of hardware, that can (un)lock the door by pressing its buttons. Obviously that’s not pretty useful on its own. Using a digital storage oscilloscope (DSO), we measured, that the buttons connect ground to a pin. Next we desoldered the buttons and soldered a couple of wires instead. These wires are connected to GPIO pins of our access control system sharing a common ground, so that it can “press” the buttons by shortly settings the relevant GPIO pins to low.<p>So far so good. Other spaces use more or less the same setup and its pretty easy to implement the above changes. But the ABUS CFA1000 also has a small display, which displays its current state (locked/unlocked). That state also changes if the door is opened manually, so we were interested in it. After unsuccessfully trying to find that information via some boolean style pin on the PCB, we decided trying to reverse engineer the protocol used for the display.<p>The display is laying on top of the main PCB using some kind of foam connector. So it’s easy to probe the outputs from the CFA1000’s µC by removing the display and just connecting a DSO to the PCB pads. On the other hand its hard to do anything with the display without creating some PCB just for that task, since we cannot solder anything to it.<p>The first thing we noticed after having a look on our scope was, that the display is driven using 4 different voltage levels: 0V, 1V, 2V, 3V, 4V (voltage differs based on the voltage supplied to the CFA1000). Also from the schematics we got the information, that 4 pins are labeled SEG and 5 pins are labeled COM.<p><img alt=Signal decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/combined-layout-signal.svg><p>Measuring 4 pins at a time due to our scope not providing more input channels, we had a look at all 9 pins and noticed a few things:<ul><li>Pin 5-8 show a regular pattern independent of the display content<li>The behaviour of the other pins changes with different display content<li>Pin 5-8 have exactly the same pattern, but shifted<li>0V is always followed by 4V on pin 5-8 and 4V is always followed by 0V on pin 0-4<li>Similarly 2V and 3V follow each other</ul><p>We assume, that Pin 5-8 are our COM signals and are some kind of layer selection. It seems there are 4 time slots with each of them having two sub-slots. With that assumption we noticed, that each time slot either contains a 0V/4V pair or a 2V/3V pair. So we assume, that 0V/4V pair means the time slot is a logic “1” and 2V/3V pair is a logic “0”.<p>We also noticed, that the sub-slots of the SEG pins are inverted compared to the COM pins. So if e.g. SEG4 is on 4V, then the COM pin is either in its middle state, or at 0V. With the second sub-slot being inverted compared to the first one it means the pins are driven in both voltage directions. We assume, that its probably some hack to get the polarity right.<p>Anyways we still need to know, which pin is used for which segment on the display. Unfortunately we cannot easily connect the display to another PCB and on the ABUS pcb there is no easy method to inject a custom signal to the display. So instead we reconnected the display and let the CFA1000 generate something on the display for us. Then we put a piece of paper between the CFA1000’s PCB and on of the display’s pins and had a look, which segment was no longer displayed due to this. From time to time we had to press some buttons to generate other symbols on the display, because the segments must be enabled in the first place of course. Doing that we could identify basically all pins and created the following pin information graphic (C=COM, S=SEG):<p><img alt="Pin Identification" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/pins.svg><p>With that we can decode the information from the display. We verified this by removing the display again, connecting our scope and trying to decode the display manually. After identifying a few incorrect pins (probably the piece of paper did accidently cover the wrong pin) and we were happy with the results, we started to think about a PCB doing the decoding for us.<p>First of all we somehow needed to get the 4-voltage-level signal into a 2-voltage-level binary signal. We initially tried to do that using zener-diodes to cap the voltage combined with some schmitt-triggers. The schmitt-triggeres feed the information into a ATmega then, which decodes the display pins and provides the information via I²C. Unfortunately, that turned out not to work that well. The voltage dropped, because the CFA1000’s µC did not provide enough energy for this setup. The image below shows our first attempt.<p><img alt="PCB with diodes" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/pcb-diodes.png><p>After finding a few more issues, we decided to start from scratch using a completly different design based on voltage comparators. We added a 4 comparators checking if the COM pins are above a certain voltage level near the 4V mark and another 5, that check if the SEG pins are below a reference voltage near the 1V mark. After the comparator we have a digital signal, where a segment is enabled if the SEG pin and the COM pin are high.<p>In theory we could just connect this to an ATmega again and decode the signal now. This time we try to solve the problem in hardware though and add 4 latches<ul><li>one for each layer/COM pin. The latches will take over values from their input pins, if their “Load” pin is high. So we can simply connect the first COM pin to the first latch’s Load pin, the second COM pin to the second latch’s Load pin and so on. Then the latches will take over values when the layer is activated. The SEG pins on the other hand can simply be connected to each latch. The output pins will then provide the state of all segments (there are 4*5 = 20 possible combinations, but some of them are not used).</ul><p>We connected the relevant pins to a simple I²C port-expander (MCP23017), so that we can read the display state from our access control system. The expander also provides an interrupt pin to notify the host system, that one of the input pins changed.<p><img alt="PCB schematic" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/pcb-schematic.svg><p>So far so good from the digital side. Unfortunately it again did not work as expected. So let’s get out our scope again and check the lines: The voltage comparators work greatly this time and we have nice boolean values behind it.<p>The screenshot below shows one of the raw COM signals (yellow) together with the cleaned variant (cyan). Also visible is one of the raw SEG signals (purple) together with its cleaned variant (blue). So why is it not working?<p><img alt="Screenshot from DSO" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/scope1.png><p>Looking further we noticed, that the COM signal is enabled slightly longer, than the SEG signal. Thus our latch will take over incorrect values. We actually want the COM signal to be enabled slightly later than the SEG signal and be disabled slightly before, so that the SEG signal is always valid when the latch takes over values.<p>On the other hand we do not need good signal edges, so we solved the problem using capacitors. To ensure, that SEG is initialized before the COM signal we started with a capacitor on the COM line. To avoid increasing the problem for the falling edge side, we added a diode, so that the capacitor is discharged fastly here. Now we also added a capacitor to the SEG signals, so that it keeps its value a bit longer. This capacitor must be smaller than the one for the COM signal to avoid breaking the start behaviour.<p>Below you can see screenshots of the resulting signals. The yellow one is a COM signal and the purple one is a SEG signal. The blue one shows the matching output of the latch. As you can see it keeps it value at high.<p><img alt="Screenshot from DSO" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/flanks.png><p>With that fixed we ordered a nice PCB in china and soldered it and found it mostly working. Unfortunately we still had two pins wrong, so we had to patch the PCB to get the right signal lines from the latches to the port expander. If we ever need another PCB, we add another port expander and add the additional signal lines and the buttons there instead of directly providing them to the host system.<p><img alt="The resulting PCB" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/board.png> <img alt="The resulting PCB" decoding=async loading=lazy src=/media/blog/2016/abus-cfa1000-display-grabber/result.jpg></div></div><div class=col-lg-3><div class="mb-auto d-flex flex-column"><div class="d-flex flex-column"><h3><a class=ms-2 href=//status.mainframe.io> Status </a></h3><div class=px-2 id=space-status style=font-size:.9em><a class="d-flex p-0 flex-column text-decoration-none btn btn-white rounded-0 text-dark d-none border-bottom border-black" href=//status.mainframe.io id=status-template role=button> <div class="text-start ps-1 fw-bold lh-sm" id=status-name-template>Template:</div> <div class="text-end pe-1 lh-sm" id=status-text-unknown-template>???</div> <div class="text-end pe-1 lh-sm d-none" id=status-text-closed-template>Geschlossen</div> <div class="text-end pe-1 lh-sm d-none" id=status-text-closing-template>Schließt bald</div> <div class="text-end pe-1 lh-sm d-none" id=status-text-open-template>Geöffnet</div> <div class="text-end pe-1 lh-sm d-none" id=status-text-member-template>Geschlossen (Member Only)</div> <div class="text-end pe-1 lh-sm d-none" id=status-text-keyholder-template>Geschlossen (Keyholder Only)</div> </a></div></div><div class="d-flex mt-2 flex-column"><h3><a class=ms-2 href=https://ktt-ol.github.io/calendar/> Termine </a></h3><div class=px-2 style=font-size:.9em></div></div></div></div></main><footer class="border-top pt-2 mt-5 row" id=footer><div class=col><p style=text-align:center>© 2025 <a href=https://ktt-ol.github.io>Kreativität trifft Technik</a> | License: <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC-BY-SA 4.0</a> | <a href=https://ktt-ol.github.io/impressum/>Impressum</a></div></footer></div><script async integrity=sha384-1G/Ktf1eAP9M5l65w5viov46isK3CQ2f1pML7ZTSpgeAK0sz2zkDxQUwmixq1jrU src=https://ktt-ol.github.io/js/site.js type=module></script><script async integrity=sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q src=https://ktt-ol.github.io/js/bootstrap.bundle.min.js type=module></script><script>const ROOMS = [{"name":"spaceOpen","title":{"de":"Hackspace","en":"Hackspace"}},{"name":"machining","title":{"de":"Zerspanung","en":"Machining"}},{"name":"woodworking","title":{"de":"Holzwerkstatt","en":"Woodworking"}},{"name":"lab3dOpen","title":{"de":"3D Lab","en":"3D Lab"}},{"name":"radstelleOpen","title":{"de":"Radstelle","en":"Cycling"}}];</script>